function widget:GetInfo() 
  return {
    name    = "Audio Alert - Victory and Defeat Sound",
    desc    = "Plays a sound on victory, defeat, or draw (not for spectators or replays)",
    author  = "FrequentPilgrim",
    date    = "2025-06-10",
    license = "GNU GPL v2",
    enabled = true,
    layer   = 0,
  }
end

local victorySound = "LuaUI/Sounds/congratulationscommander.ogg"
local defeatSound  = "LuaUI/Sounds/wehavebeenannihilated.ogg"
local drawSound    = "LuaUI/Sounds/itisadraw.ogg"

local played = false
local startedAsSpec = false

function widget:Initialize()
  if Spring.IsReplay() then
    startedAsSpec = true
    return
  end

  local myTeamID = Spring.GetMyTeamID()
  local _, _, spec, _, _, _, _, _, _, _, _, aiShortName = Spring.GetTeamInfo(myTeamID, false)
  startedAsSpec = spec or aiShortName ~= nil
end

function widget:GameOver(winningAllyTeams)
  if played then return end
  played = true

  if startedAsSpec or Spring.IsReplay() then return end

  -- Handle draw (no winner)
  if not winningAllyTeams or #winningAllyTeams == 0 then
    Spring.PlaySoundFile(drawSound, 3.0, "ui")
    return
  end

  -- Check for victory
  local myAllyTeamID = Spring.GetMyAllyTeamID()
  for _, allyTeamID in ipairs(winningAllyTeams) do
    if allyTeamID == myAllyTeamID then
      Spring.PlaySoundFile(victorySound, 3.0, "ui")
      return
    end
  end

  -- Default: defeat
  Spring.PlaySoundFile(defeatSound, 3.0, "ui")
end
